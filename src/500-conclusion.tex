% !TEX root = document.tex
\chapter{\label{chap:conclusion}Conclusion}

In this thesis we have examined how CPS can be improved upon as an IR. We have proposed command trees as a solution, which helps both language implementers and compiler writers. Our new compilation scheme is validated by using it to implement LamToWat, a compiler from the lambda calculus to WebAssembly. 

We started by discussing a refence implementation of LamToWat and showed how the source code is transformed by CPS conversion, closure conversion, and emitting. We identified three shortcomings of the IR: complex specification of control flow, lack of types after hoisting, and constructor duplication.

We proposed command trees as the solution to these shortcomings. There are two types of command trees: semantic and syntactic. We had to split our data type because the semantic command trees did not allow for variable analysis. We conjecture the possibility of an isomorphism between the two. The new implementation of LamToWat is made up of more transformations, which provide more explicitness and declarativity. The use of open unions gave rise to a more modular approach to compilation.

We tested both implementations of LamToWat by compiling and running programs in the lambda calculus and checking their results. The implementation of command trees in this thesis can be extended in many aspects. In chapter \ref{chap:commandtrees} we proposed improvements of command trees and in \ref{subsection:othert} we listed a number of improvements with respect to the compiler itself. The context that gives rise to command trees is denotational semantics. The final goal of our approach is to give a modular denotational semantics of compilation. 